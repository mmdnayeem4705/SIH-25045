<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Dashboard - AgriChain</title>
    <link rel="stylesheet" href="/customer-app/styles.css">
    <style>
        .lang { display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid #2c3e50; border-radius:10px; background:#ffffff; color:#000000; }
        .lang label { font-size:14px; color:#000000; }
        .lang select {
            min-width: 160px;
            background: #d7c9e5f0;
            color: #4f85df;
            border: none;
            outline: none;
        }
    </style>
    <script src="/i18n.js"></script>
    <script src="/translations.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-shopping-cart"></i>
                <span data-i18n="nav.customerPortal">AgriChain - Customer Portal</span>
            </div>
            <div class="nav-user">
                <div class="user-info">
                    <span class="user-name" id="userName">Loading...</span>
                    <span class="user-code" id="userCode">Loading...</span>
                </div>
                <button class="logout-btn" onclick="logout()" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
                <div class="lang" style="margin-left:12px">
                    <label for="customerLang" data-i18n="lang.label">Language</label>
                    <select id="customerLang"></select>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 data-i18n="customer.welcomeTitle">Welcome to Your Customer Dashboard</h1>
            <p data-i18n="customer.welcomeSubtitle">Buy fresh, verified crops directly from farmers or Agricultural Verification Officers</p>
        </div>

        <!-- Main Action Cards -->
        <div class="action-cards">
            <!-- Buy from Farmers Card -->
            <div class="action-card farmer-buy-card" onclick="showBuyFromFarmers()">
                <div class="card-icon">
                    <i class="fas fa-tractor"></i>
                </div>
                <h3 data-i18n="customer.cards.buyFarmers.title">Buy from Farmers</h3>
                <p data-i18n="customer.cards.buyFarmers.desc">Purchase crops directly from farmers at fixed prices</p>
                <div class="card-stats">
                    <div class="stat">
                        <span class="stat-number" id="farmerPurchases">0</span>
                        <span class="stat-label">Farmer Purchases</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number" id="farmerSpent">₹0</span>
                        <span class="stat-label">Amount Spent</span>
                    </div>
                </div>
            </div>

            <!-- Buy from Officers Card -->
            <div class="action-card officer-buy-card" onclick="showBuyFromOfficers()">
                <div class="card-icon">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <h3 data-i18n="customer.cards.buyOfficers.title">Buy from Officers</h3>
                <p data-i18n="customer.cards.buyOfficers.desc">Purchase verified, quality-assured crops from Agricultural Verification Officers</p>
                <div class="card-stats">
                    <div class="stat">
                        <span class="stat-number" id="officerPurchases">0</span>
                        <span class="stat-label">Officer Purchases</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number" id="officerSpent">₹0</span>
                        <span class="stat-label">Amount Spent</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Sections -->
        <div class="content-sections">
            <!-- Buy from Farmers Section -->
            <div class="content-section" id="buyFromFarmersSection" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-tractor"></i> Buy from Farmers</h2>
                    <div class="section-actions">
                        <div class="filters">
                            <select id="farmerCropFilter" onchange="filterFarmerCrops()">
                                <option value="all">All Crops</option>
                                <option value="CEREAL">Cereal</option>
                                <option value="PULSE">Pulse</option>
                                <option value="OILSEED">Oilseed</option>
                                <option value="VEGETABLE">Vegetable</option>
                                <option value="FRUIT">Fruit</option>
                                <option value="SPICE">Spice</option>
                            </select>
                            <select id="farmerPriceFilter" onchange="filterFarmerCrops()">
                                <option value="all">All Prices</option>
                                <option value="0-25">₹0 - ₹25</option>
                                <option value="25-50">₹25 - ₹50</option>
                                <option value="50-100">₹50 - ₹100</option>
                                <option value="100+">₹100+</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Farmer Crop Listings -->
                <div class="crop-listings">
                    <h3>Available Crops from Farmers</h3>
                    <div class="listings-grid" id="farmerCropsGrid">
                        <!-- Farmer crop listings will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Buy from Officers Section -->
            <div class="content-section" id="buyFromOfficersSection" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-clipboard-check"></i> Buy from Officers</h2>
                    <div class="section-actions">
                        <div class="filters">
                            <select id="officerCropFilter" onchange="filterOfficerCrops()">
                                <option value="all">All Crops</option>
                                <option value="CEREAL">Cereal</option>
                                <option value="PULSE">Pulse</option>
                                <option value="OILSEED">Oilseed</option>
                                <option value="VEGETABLE">Vegetable</option>
                                <option value="FRUIT">Fruit</option>
                                <option value="SPICE">Spice</option>
                            </select>
                            <select id="officerQualityFilter" onchange="filterOfficerCrops()">
                                <option value="all">All Quality</option>
                                <option value="A">Grade A (Excellent)</option>
                                <option value="B">Grade B (Good)</option>
                                <option value="C">Grade C (Average)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Officer Crop Listings -->
                <div class="crop-listings">
                    <h3>Verified Crops from Officers</h3>
                    <div class="listings-grid" id="officerCropsGrid">
                        <!-- Officer crop listings will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Purchase History -->
        <div class="purchase-history">
            <div class="section-header">
                <h2><i class="fas fa-history"></i> Purchase History</h2>
                <div class="section-actions">
                    <select id="historyFilter" onchange="filterPurchaseHistory()">
                        <option value="all">All Purchases</option>
                        <option value="farmer">From Farmers</option>
                        <option value="officer">From Officers</option>
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
            </div>
            <div class="history-list" id="purchaseHistoryList">
                <!-- Purchase history will be populated here -->
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="quick-stats">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="stat-content">
                    <h3 id="totalPurchases">0</h3>
                    <p>Total Purchases</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-rupee-sign"></i>
                </div>
                <div class="stat-content">
                    <h3 id="totalSpent">₹0</h3>
                    <p>Total Spent</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-content">
                    <h3 id="customerRating">0.0</h3>
                    <p>Your Rating</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-gift"></i>
                </div>
                <div class="stat-content">
                    <h3 id="loyaltyPoints">0</h3>
                    <p>Loyalty Points</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Purchase Modal -->
    <div class="modal" id="purchaseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-shopping-cart"></i> Purchase Crop</h2>
                <button class="close-btn" onclick="closeModal('purchaseModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="purchaseForm">
                    <div class="crop-details">
                        <h3>Crop Details</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <label>Crop Name:</label>
                                <span id="purchaseCropName">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Seller:</label>
                                <span id="purchaseSellerName">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Available Quantity:</label>
                                <span id="purchaseAvailableQuantity">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Price per Kg:</label>
                                <span id="purchasePricePerKg">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Quality Grade:</label>
                                <span id="purchaseQualityGrade">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Harvest Date:</label>
                                <span id="purchaseHarvestDate">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="purchase-form">
                        <h3>Purchase Details</h3>
                        <div class="form-group">
                            <label for="purchaseQuantity">Quantity (kg)</label>
                            <input type="number" id="purchaseQuantity" name="quantity" min="0.1" step="0.1" required>
                            <small class="form-help">Maximum available: <span id="maxQuantity">0</span> kg</small>
                        </div>

                        <div class="form-group">
                            <label for="deliveryAddress">Delivery Address</label>
                            <select id="deliveryAddress" name="deliveryAddress" required>
                                <option value="">Select Address</option>
                                <!-- Options will be populated dynamically -->
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="paymentMethod">Payment Method</label>
                            <select id="paymentMethod" name="paymentMethod" required>
                                <option value="">Select Payment Method</option>
                                <option value="UPI">UPI</option>
                                <option value="CARD">Credit/Debit Card</option>
                                <option value="NET_BANKING">Net Banking</option>
                                <option value="COD">Cash on Delivery</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="specialInstructions">Special Instructions</label>
                            <textarea id="specialInstructions" name="specialInstructions" placeholder="Any special delivery instructions or requirements"></textarea>
                        </div>

                        <div class="purchase-summary">
                            <h4>Purchase Summary</h4>
                            <div class="summary-item">
                                <span>Quantity:</span>
                                <span id="summaryQuantity">0 kg</span>
                            </div>
                            <div class="summary-item">
                                <span>Price per kg:</span>
                                <span id="summaryPrice">₹0</span>
                            </div>
                            <div class="summary-item">
                                <span>Subtotal:</span>
                                <span id="summarySubtotal">₹0</span>
                            </div>
                            <div class="summary-item">
                                <span>Delivery Charges:</span>
                                <span id="summaryDelivery">₹0</span>
                            </div>
                            <div class="summary-item total">
                                <span>Total Amount:</span>
                                <span id="summaryTotal">₹0</span>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeModal('purchaseModal')">Cancel</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-credit-card"></i> Proceed to Payment
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        (function initI18n(){
            var target = document.getElementById('customerLang');
            var langs = [
                { code: 'en', label: 'English' },
                { code: 'hi', label: 'हिन्दी (Hindi)' },
                { code: 'te', label: 'తెలుగు (Telugu)' },
                { code: 'kn', label: 'ಕನ್ನಡ (Kannada)' }
            ];
            langs.forEach(function(l){ var o=document.createElement('option'); o.value=l.code; o.textContent=l.label; target.appendChild(o); });
            I18n.init({ translations: window.translations, defaultLang: 'en' });
            target.value = I18n.current;
            target.addEventListener('change', function(e){ I18n.apply(e.target.value); });
        })();
    </script>
    <script src="/customer-app/script.js"></script>
</body>
</html>
